<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Autocomplétion Multi-Types</title>
    <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="vendor/fontawesome/css/all.min.css" rel="stylesheet">
    <link href="../css/custom.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h1 class="mb-4">
            <i class="fas fa-flask"></i> Test Autocomplétion Multi-Types
        </h1>
        
        <div class="alert alert-info">
            <i class="fas fa-info-circle"></i>
            <strong>Instructions :</strong> Tapez dans les champs ci-dessous pour tester l'autocomplétion.
            Les variables TestGyver sont en <span class="text-primary fw-bold">bleu</span>,
            les variables du test sont en <span class="text-success fw-bold">vert</span> et
            les variables de collection sont en <span class="text-danger fw-bold">rouge</span>.
        </div>

        <div class="card mb-4">
            <div class="card-header">
                <i class="fas fa-keyboard"></i> Zones de test
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <label for="testInput1" class="form-label">Champ texte 1</label>
                    <input type="text" class="form-control" id="testInput1" 
                           placeholder="Tapez pour voir les suggestions...">
                </div>

                <div class="mb-3">
                    <label for="testInput2" class="form-label">Champ texte 2</label>
                    <input type="text" class="form-control" id="testInput2" 
                           placeholder="Exemple: url">
                </div>

                <div class="mb-3">
                    <label for="testTextarea" class="form-label">Zone de texte</label>
                    <textarea class="form-control" id="testTextarea" rows="4" 
                              placeholder="Tapez pour voir les suggestions... Essayez 'token', 'user', 'api'..."></textarea>
                </div>
            </div>
        </div>

        <div class="card mb-4">
            <div class="card-header">
                <i class="fas fa-cog"></i> Configuration
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-4">
                        <h6 class="text-primary"><i class="fas fa-database"></i> Variables TestGyver</h6>
                        <ul class="list-group mb-3">
                            <li class="list-group-item">
                                <code>{{url_api}}</code>
                                <span class="badge bg-primary ms-2">TestGyver</span>
                            </li>
                            <li class="list-group-item">
                                <code>{{username}}</code>
                                <span class="badge bg-primary ms-2">TestGyver</span>
                            </li>
                            <li class="list-group-item">
                                <code>{{password}}</code>
                                <span class="badge bg-primary ms-2">TestGyver</span>
                            </li>
                        </ul>
                    </div>
                    <div class="col-md-4">
                        <h6 class="text-success"><i class="fas fa-vial"></i> Variables du Test</h6>
                        <ul class="list-group mb-3">
                            <li class="list-group-item">
                                <code>{{app.token}}</code>
                                <span class="badge bg-success ms-2">Test</span>
                            </li>
                            <li class="list-group-item">
                                <code>{{app.user_id}}</code>
                                <span class="badge bg-success ms-2">Test</span>
                            </li>
                            <li class="list-group-item">
                                <code>{{app.response_code}}</code>
                                <span class="badge bg-success ms-2">Test</span>
                            </li>
                        </ul>
                    </div>
                    <div class="col-md-4">
                        <h6 class="text-danger"><i class="fas fa-layer-group"></i> Variables de Collection</h6>
                        <ul class="list-group mb-3">
                            <li class="list-group-item">
                                <code>{{test.test_id}}</code>
                                <span class="badge bg-danger ms-2">Collection</span>
                            </li>
                            <li class="list-group-item">
                                <code>{{test.campain_id}}</code>
                                <span class="badge bg-danger ms-2">Collection</span>
                            </li>
                        </ul>
                    </div>
                </div>

                <div class="mt-3">
                    <button class="btn btn-sm btn-success" id="addTestVar">
                        <i class="fas fa-plus"></i> Ajouter une variable test
                    </button>
                    <button class="btn btn-sm btn-danger" id="clearTestVars">
                        <i class="fas fa-trash"></i> Effacer les variables test
                    </button>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <i class="fas fa-chart-line"></i> Statistiques
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-3">
                        <div class="text-center">
                            <h3 class="text-primary" id="countTestGyver">0</h3>
                            <small class="text-muted">Variables TestGyver</small>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="text-center">
                            <h3 class="text-success" id="countTest">0</h3>
                            <small class="text-muted">Variables du Test</small>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="text-center">
                            <h3 class="text-danger" id="countCollection">0</h3>
                            <small class="text-muted">Variables de Collection</small>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="text-center">
                            <h3 class="text-info" id="countTotal">0</h3>
                            <small class="text-muted">Total</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mock de l'objet API pour le test -->
    <script>
        const API = {
            get: async (endpoint) => {
                console.log('[Mock API] GET:', endpoint);
                // Simuler des variables TestGyver
                return {
                    items: [
                        { key: 'url_api', description: 'URL de l\'API', isRoot: true },
                        { key: 'username', description: 'Nom d\'utilisateur', isRoot: true },
                        { key: 'password', description: 'Mot de passe', isRoot: true },
                        { key: 'api_key', description: 'Clé API', isRoot: true },
                        { key: 'environment', description: 'Environnement', isRoot: true }
                    ]
                };
            }
        };

        const Notification = {
            success: (msg) => console.log('✅', msg),
            error: (msg) => console.error('❌', msg)
        };
    </script>

    <script src="../js/variable-autocomplete.js"></script>

    <script>
        let testVariables = ['token', 'user_id', 'response_code'];
        let autocomplete;

        // Initialiser
        document.addEventListener('DOMContentLoaded', async () => {
            autocomplete = new VariableAutocomplete({
                apiEndpoint: '/api/variables?isRoot=true&page_size=100'
            });

            // Attendre que les variables TestGyver soient chargées
            await new Promise(resolve => setTimeout(resolve, 500));

            // Définir les variables du test
            autocomplete.setVariables('test', testVariables);

            // Mettre à jour les statistiques
            updateStats();

            // Événements
            document.getElementById('addTestVar').addEventListener('click', () => {
                const varName = prompt('Nom de la nouvelle variable :');
                if (varName && varName.trim()) {
                    testVariables.push(varName.trim());
                    autocomplete.setVariables('test', testVariables);
                    updateStats();
                    alert(`Variable "${varName}" ajoutée !`);
                }
            });

            document.getElementById('clearTestVars').addEventListener('click', () => {
                if (confirm('Effacer toutes les variables du test ?')) {
                    testVariables = [];
                    autocomplete.setVariables('test', testVariables);
                    updateStats();
                }
            });
        });

        function updateStats() {
            const testGyverCount = autocomplete.variablesByType.testGyver.length;
            const testCount = autocomplete.variablesByType.test.length;
            const collectionCount = autocomplete.variablesByType.collection.length;
            
            document.getElementById('countTestGyver').textContent = testGyverCount;
            document.getElementById('countTest').textContent = testCount;
            document.getElementById('countCollection').textContent = collectionCount;
            document.getElementById('countTotal').textContent = testGyverCount + testCount + collectionCount;
        }
    </script>
</body>
</html>
