# Directives de dÃ©veloppement - TestGyver

Ce fichier contient les directives et conventions Ã  respecter pour le dÃ©veloppement du projet TestGyver.

## ğŸ Commandes Python

### IMPORTANT : Utilisation systÃ©matique de python3
- âœ… **TOUJOURS** utiliser `python3` au lieu de `python`
- âœ… **TOUJOURS** utiliser `pip3` au lieu de `pip`
- âœ… Shebang obligatoire : `#!/usr/bin/env python3`
- âœ… Encodage UTF-8 : `# -*- coding: utf-8 -*-`

### Exemples corrects
```bash
python3 script.py
pip3 install package
```

### âŒ Ã€ Ã©viter
```bash
python script.py   # NON
pip install package # NON
```

## ğŸ“ Structure du projet

```
app_test/
â”œâ”€â”€ plugins/           # SystÃ¨me de plugins
â”‚   â”œâ”€â”€ actions/      # Plugins d'actions
â”‚   â”œâ”€â”€ auth/         # Plugins d'authentification
â”‚   â””â”€â”€ reports/      # Plugins de rapports
â”œâ”€â”€ routes/           # Routes Flask (API et Web)
â”œâ”€â”€ models/           # ModÃ¨les de donnÃ©es MongoDB
â”œâ”€â”€ utils/            # Utilitaires (auth, db, pagination, workdir)
â”œâ”€â”€ templates/        # Templates Jinja2
â”œâ”€â”€ static/           # Fichiers statiques (CSS, JS, images)
â”‚   â””â”€â”€ vendor/       # BibliothÃ¨ques tierces locales (pas de CDN)
â”œâ”€â”€ docs/             # Documentation
â”œâ”€â”€ _build/           # Scripts de test et de build
â””â”€â”€ workdir/          # RÃ©pertoires de travail des campagnes (git-ignored)
```

## ğŸ—„ï¸ Base de donnÃ©es MongoDB

### Collections
- **users** : Utilisateurs de l'application
- **campains** : Campagnes de tests
- **tests** : Tests individuels avec actions et variables
- **rapports** : Rapports d'exÃ©cution avec statuts et progression
- **variables** : Variables multi-environnements (avec filiÃ¨res)

### Conventions de nommage
- Utiliser `ObjectId` pour les rÃ©fÃ©rences
- Convertir les ObjectId en string pour les API JSON
- Format de date : `datetime.utcnow()` et `.isoformat()` pour JSON

## ğŸ”§ Conventions de code Python

### Style
- Suivre PEP 8
- Documentation en **franÃ§ais**
- Docstrings pour toutes les fonctions et classes
- Type hints recommandÃ©s

### Exemple de docstring
```python
def ma_fonction(param1, param2):
    """
    Description de la fonction en franÃ§ais.
    
    Args:
        param1: Description du paramÃ¨tre 1
        param2: Description du paramÃ¨tre 2
    
    Returns:
        Description du retour
    """
    pass
```

## ğŸ¨ Frontend

### BibliothÃ¨ques (locales, pas de CDN)
- Bootstrap 5.3.0 (`static/vendor/bootstrap/`)
- Font Awesome 6.4.0 (`static/vendor/fontawesome/`)
- Socket.IO 4.5.4 (`static/vendor/socket.io/`)

### Templates Jinja2
- Base template : `templates/base.html`
- Utiliser `{{ url_for('static', filename='...') }}` pour les assets
- Variables globales : `app_name`, `app_version`

## ğŸ”Œ SystÃ¨me de plugins

### Structure d'un plugin
```python
from plugins.actions.action_base import ActionBase

class MonAction(ActionBase):
    plugin_name = "mon_action"
    version = "1.0.0"
    author = "TestGyver Team"
    
    def get_metadata(self):
        """Retourne les mÃ©tadonnÃ©es."""
        pass
    
    def get_input_mask(self):
        """Retourne le masque de saisie."""
        pass
    
    def execute(self, action_context):
        """ExÃ©cute l'action."""
        pass
```

### Types de plugins
- **actions** : Effectuent des opÃ©rations (HTTP, WebDAV, SSH, etc.)
- **reports** : GÃ©nÃ¨rent des rapports
- **auth** : GÃ¨rent l'authentification

## ğŸš€ API REST

### Format des rÃ©ponses
```python
# SuccÃ¨s
return jsonify({'message': 'OpÃ©ration rÃ©ussie', 'data': data}), 200

# Erreur
return jsonify({'message': 'Description de l\'erreur'}), 400
```

### Authentification
- JWT avec cookies
- DÃ©corateurs : `@token_required`, `@admin_required`
- Expiration configurable dans `configuration.json`

## ğŸ“ Variables et rÃ©solution

### Types de variables
1. **testGyver** : Variables globales ({{variable_name}})
2. **test** : Variables du test ({{app.variable_name}})
3. **collection** : Variables systÃ¨me ({{test.test_id}}, {{test.campain_id}})

### RÃ©solution dans les actions
- Les variables sont rÃ©solues avant l'exÃ©cution
- Format : `{{type.nom_variable}}`

## ğŸ§ª Tests

### Emplacement
- Scripts de test dans `_build/`
- Nommage : `test_*.py`

### ExÃ©cution
```bash
python3 _build/test_nom_du_test.py
```

## ğŸ“¦ Configuration

### Fichier `configuration.json`
```json
{
    "mongo": { ... },
    "jwt_secret": "...",
    "app": { "debug": true, "port": 5000, "host": "0.0.0.0" },
    "pagination": { "page_size": 20, "max_page_size": 100 },
    "security": { "token_expiration_minutes": 60 },
    "workdir": "./workdir",
    "version": "1.0.0"
}
```

## ğŸ”’ SÃ©curitÃ©

- Mots de passe hashÃ©s avec bcrypt
- Tokens JWT pour l'authentification
- Validation des entrÃ©es utilisateur
- Pas de CDN externes (politique de confidentialitÃ©)

## ğŸ“Š WebSocket (Flask-SocketIO)

### Ã‰vÃ©nements de campagne
- `campain_started` : DÃ©marrage d'une campagne
- `test_started` : DÃ©marrage d'un test
- `test_completed` : Fin d'un test
- `campain_progress` : Progression de la campagne
- `campain_completed` : Fin de la campagne
- `campain_error` : Erreur lors de l'exÃ©cution

## ğŸ—‚ï¸ Workdir (rÃ©pertoires de travail)

### Gestion automatique
- CrÃ©ation lors de la crÃ©ation d'une campagne
- Suppression lors de la suppression d'une campagne
- Nettoyage des orphelins au dÃ©marrage
- Chemin : `{workdir}/{campain_id}/`

### Fonctions utilitaires (`utils/workdir.py`)
- `get_workdir()`
- `ensure_workdir_exists()`
- `create_campain_workdir(campain_id)`
- `delete_campain_workdir(campain_id)`
- `get_campain_workdir(campain_id)`

## ğŸ“š Documentation

### Emplacement
- Documentation technique dans `docs/`
- README multilingues (fr, en, es, de, it)

### Mises Ã  jour
- Documenter les nouvelles fonctionnalitÃ©s
- Mettre Ã  jour `info.txt` avec statut âœ… TERMINÃ‰

## ğŸ¯ Checklist avant commit

- [ ] Utilisation de `python3` (pas `python`)
- [ ] Shebang `#!/usr/bin/env python3` dans les scripts
- [ ] Encodage `# -*- coding: utf-8 -*-`
- [ ] Documentation en franÃ§ais
- [ ] Docstrings pour les nouvelles fonctions
- [ ] Pas de CDN externes
- [ ] Tests fonctionnels
- [ ] `info.txt` mis Ã  jour si nouvelle fonctionnalitÃ©

## ğŸš« Ã€ Ã©viter absolument

- âŒ Utiliser `python` au lieu de `python3`
- âŒ Utiliser `pip` au lieu de `pip3`
- âŒ Ajouter des CDN externes
- âŒ Documenter en anglais (sauf README internationaux)
- âŒ Commiter le dossier `workdir/`
- âŒ Commiter `__pycache__/` ou `.pyc`
- âŒ Hardcoder des chemins absolus
- âŒ CrÃ©er des fichiers markdown de rÃ©sumÃ© non demandÃ©s

---

**Note** : Ce fichier doit Ãªtre consultÃ© systÃ©matiquement lors du dÃ©veloppement.
**Date de derniÃ¨re mise Ã  jour** : 31 octobre 2025
